<?php
namespace Site\Front\Controllers;


use Core\Extender\ControllerApp;

/**
 * Class IndexController
 * @package Site\Front\Controllers
 */
class MamaController extends ControllerApp
{
    public function initialize()
    {
        parent::initialize();

    }

    public function indexAction()
    {
        $array = [
            '401700353413'

        ];


        echo '<pre>';

        for($a = 0, $len = sizeof($array); $a < $len; $a++) {
            sleep(1);
            $daDataRes = $this->daData->findById('party', $array[$a]);


            if (sizeof($daDataRes)) {
                $data = $daDataRes[0]['data'];
                $memberId = $this->user->getId();

                $title = $data['name']['short_with_opf'];

                echo ((int)$this->db->query(
                        'SELECT pm.counteragent_create(:mid, :tit::varchar(512), :ddt::jsonb) AS res',
                        [
                            'mid' => $memberId,
                            'tit' => $title,
                            'ddt' => json_encode($data)
                        ]
                    )->fetch()['res']).'<br>';
            }
        }





        $this->view->disable();
        exit;
    }

    public function clearNameAction() {
        $agents = $this->db->query(
            '
                SELECT counteragent_id
                     , counteragent_title  
                FROM pm.counteragent AS c
                WHERE counteragent_title like \'%"%\'
            '
        );

        while($row = $agents->fetch()) {
            $expld = explode(' ', $row['counteragent_title']);

            $opf = $expld[0];

            $name = substr($row['counteragent_title'], strlen($opf), strlen($row['counteragent_title']) - strlen($opf));

            $name = str_replace('"', '', $name);

            $name = $name . ' '.$opf;

            echo $name.'<br>';

            $this->db->query(
                'UPDATE pm.counteragent SET counteragent_title = :tit WHERE counteragent_id = :cid',
                [
                    'tit' => $name,
                    'cid' => $row['counteragent_id']
                ]
            );
        }

        die('another day');
    }

    public function syncAction()
    {

        exit;
        $array = [
            ['113104','2085','7605016030'],
            ['113092','1833','131100890350'],
            ['113035','2098','5040125118'],
            ['112995','539','6950106609'],
            ['112985','539','7720688986'],
            ['112788','69','2221228776'],
            ['112734','2085','7605016030'],
            ['112686','996','3123168351'],
            ['112655','2194','7709500060'],
            ['112649','1664','7735572247'],
            ['112594','1977','5024144480'],
            ['112592','1977','6027012974'],
            ['112559','2506','3123110760'],
            ['112373','1130','6910020105'],
            ['112363','1833','5029143963'],
            ['112279','238','6952319842'],
            ['112251','2142','7814551360'],
            ['112041','2098','22919777'],
            ['111974','1757','9731087807'],
            ['111848','1995','9704119665'],
            ['111650','2490','6905003457'],
            ['111503','1977','4704029839'],
            ['111404','1757','333800671709'],
            ['111399','1833','131100890350'],
            ['111340','1977','2463240412'],
            ['111081','1977','9724039640'],
            ['111041','1977','7737128894'],
            ['110587','2098','5920029970'],
            ['110497','1130','6901075838'],
            ['110464','1977','DE815693059'],
            ['110427','1757','6671276294'],
            ['110423','1428','7714158099'],
            ['110269','1977','1402025952'],
            ['110242','1757','7702167155'],
            ['110111','996','3102040819'],
            ['109983','2271','3123430111'],
            ['109769','69','773574497440'],
            ['109579','996','312100742710'],
            ['109493','1995','7709219099'],
            ['109271','1664','4307012412'],
            ['109198','1664','3525150820'],
            ['108882','1484','7701101088'],
            ['104914','2506','3128146520'],
            ['104882','2098','4632061534'],
            ['104855','1833','7736656394'],
            ['104688','2098','5036133437'],
            ['104611','1977','2308267138'],
            ['104582','928','7710918800'],
            ['104463','1326','7709219099'],
            ['104304','2271','3123323783'],
            ['104236','1082','690200073514'],
            ['104144','996','312320169188'],
            ['104139','1551','2627022215'],
            ['104100','1977','4003016140'],
            ['103930','1757','5036065113'],
            ['103836','26','7707049388'],
            ['103779','1977','6443021868'],
            ['103741','996','3123113786'],
            ['103711','996','3123106588'],
            ['103646','1977','5247046423'],
            ['103644','2098','7801651230'],
            ['103544','1757','7717042053'],
            ['103491','996','4632193548'],
            ['103406','1130','690500387102'],
            ['103403','1130','772027923564'],
            ['103395','1130','690141773092'],
            ['103393','1757','6670395926'],
            ['103288','2527','7727757597'],
            ['103091','996','3123387579'],
            ['103080','2098','15747035'],
            ['103065','1082','772027923564'],
            ['103045','996','3123106588'],
            ['102962','1977','7839495100'],
            ['102887','1977','2636033069'],
            ['102846','69','7713076301'],
            ['102840','1551','7708781107'],
            ['102770','1551','5024124170'],
            ['102724','69','232300737315'],
            ['102675','2126','7801651230'],
            ['102660','1664','6319225514'],
            ['102578','1664','3528171360'],
            ['102549','2271','3123430111'],
            ['101435','1757','7702850690'],
            ['101430','996','312303272805'],
            ['101382','1757','7726715562'],
            ['101363','1977','7729445995'],
            ['101275','1664','7842437002'],
            ['101266','1977','6725012156'],
            ['101222','2098','17137695'],
            ['101213','1977','1001054385'],
            ['101028','1977','3664209020'],
            ['100965','26','7740000076'],
            ['100847','1977','1838015102'],
            ['100561','1664','7725665044'],
            ['100414','1664','7733806972'],
            ['99890','1664','7802184161'],
            ['99654','682','771310005702'],
            ['99607','1664','5010035805'],
            ['99363','1977','2320225984'],
            ['99315','1664','7726535270'],
            ['99310','1664','5445024710'],
            ['99265','996','312802138996'],
            ['99235','1664','7002013858'],
            ['99120','1664','7814327760'],
            ['99114','1664','7740000076'],
            ['99063','1757','3327823216'],
            ['99018','1977','7107089389'],
            ['98957','44','232300737315'],
            ['98937','1664','6611013981'],
            ['98835','2527','7724320689'],
            ['98819','2098','5056000107'],
            ['98811','1082','6901071985'],
            ['98792','1664','2310171761'],
            ['98757','1757','7708503727'],
            ['98659','1977','7751082560'],
            ['98543','996','3123192080'],
            ['98542','996','3123433521'],
            ['98514','928','7710918800'],
            ['98293','2098','7740000076'],
            ['98282','2098','7722624201'],
            ['98181','1977','6141057201'],
            ['98137','1664','4824081559'],
            ['98059','2098','7719571687'],
            ['98046','1977','7727395481'],
            ['98041','1664','5056006814'],
            ['97999','2098','3525128091'],
            ['97993','2098','6143049372'],
            ['97935','2098','9704119665'],
            ['97848','1977','6619016800'],
            ['97710','1833','7733275344'],
            ['97687','1010','7725498876'],
            ['97652','1664','4345079182'],
            ['97602','2098','5262067308'],
            ['97424','1130','6950226695'],
            ['97339','26','7707049388'],
            ['97335','26','7707049388'],
            ['97333','26','7709219099'],
            ['97280','1130','6950185110'],
            ['97225','2098','6681005215'],
            ['97187','1664','7715791593'],
            ['97172','1082','7702747780'],
            ['97037','1664','7704426260'],
            ['96993','NULL','7714158099'],
            ['96973','1664','7117501097'],
            ['96827','1082','690303281851'],
            ['96686','1977','7722624201'],
            ['96602','1664','5030072298'],
            ['96586','1551','7017016869'],
            ['96575','1664','7814551360'],
            ['96496','2271','312820720011'],
            ['96411','1060','7714158099'],
            ['96377','1977','2373012436'],
            ['96098','1060','7709219099'],
            ['96065','1060','7714158099'],
            ['96058','1060','7714955136'],
            ['96036','1060','7825098536'],
            ['95974','1833','7733275344'],
            ['95927','1082','695204737388'],
            ['95909','996','312303116436'],
            ['95906','1082','6950193200'],
            ['95897','2459','7714955136'],
            ['95822','1010','7703534295'],
            ['95765','2281','7713016366'],
            ['95544','1326','7710140679'],
            ['95455','1977','7740000076'],
            ['95394','1664','4401161027'],
            ['95315','1776','7714158099'],
            ['95093','26','5402046082'],
            ['94987','1664','5029143963'],
            ['94985','1664','5036112765'],
            ['94941','1664','7707049388'],
            ['94781','1757','5032137342'],
            ['94659','1664','7709219099'],
            ['94638','69','7723663732'],
            ['94609','1664','2315127639'],
            ['94511','1664','7716513239'],
            ['94373','1757','7729670341'],
            ['94244','1664','7325096266'],
            ['94134','189','7705307770'],
            ['93844','1977','401700353413'],
            ['93793','789','5030072298'],
            ['93538','1664','773128218747'],
            ['93429','NULL','5032137342'],
            ['93428','1040','7704552473'],
            ['93342','1664','7703059410'],
            ['93267','69','7714158099'],
            ['93197','1664','2306003330'],
            ['93077','1664','5001096463'],
            ['93061','1664','9715248863'],
            ['93060','26','4401088176'],
            ['92956','2271','3128020567'],
            ['92838','1082','7713076301'],
            ['92818','1664','5050045380'],
            ['92817','1664','5050045380'],
            ['92816','1082','6901035391'],
            ['92753','144','7740000076'],
            ['92716','1664','7713654489'],
            ['92715','1856','4401088176'],
            ['92602','1664','3525338684'],
            ['92535','26','7715188378'],
            ['92403','996','3123108320'],
            ['92338','1664','2456009733'],
            ['92301','1889','7715188378'],
            ['92150','996','3123113384'],
            ['92101','238','7107115529'],
            ['91891','996','3123168351'],
            ['91761','1082','6952313505'],
            ['91708','996','3126017110'],
            ['91674','1130','690102071364'],
            ['91672','996','3123148080'],
            ['91630','1977','5260310564'],
            ['91603','996','3128072163'],
            ['91516','1326','7813412719'],
            ['91471','26','7719403594'],
            ['91319','NULL','7714158099'],
            ['91224','1664','7710140679'],
            ['91132','26','1106022398'],
            ['91072','1664','7448079060'],
            ['90832','1664','7719403594'],
            ['90707','26','7423000572'],
            ['90700','1130','6950218623'],
            ['90666','1757','7706284124'],
            ['90636','1664','7709219099'],
            ['90633','1833','7715354219'],
            ['90578','996','3128057285'],
            ['90450','1633','9723040900'],
            ['90408','1757','7710016640'],
            ['90405','1757','7708000882'],
            ['89954','1856','1106022398'],
            ['89841','1664','1103042163'],
            ['89771','26','5038088765'],
            ['89591','69','5902202276'],
            ['89472','928','3128050160'],
            ['89121','1664','7743085617'],
            ['89089','750','5038088765'],
            ['89041','996','3123299570'],
            ['88916','1664','7717284782'],
            ['88906','238','7605016030'],
            ['88756','1871','7709219099'],
            ['88704','69','3015062598'],
            ['87836','2271','3123355954'],
            ['87769','996','3110009040'],
            ['87646','1664','7744000912'],
            ['87644','1664','4202052288'],
            ['87621','26','4202052288'],
            ['86983','1664','7716559138'],
            ['86818','1757','5024017676'],
            ['86792','1757','5010048868'],
            ['86788','1757','5010031060'],
            ['86785','1757','5010035259'],
            ['86772','789','5030072298'],
            ['86679','1757','7707049388'],
            ['86633','928','7703717852'],
            ['86605','1130','6950028894'],
            ['86604','1130','6950028894'],
            ['86516','488','7707049388'],
            ['86414','1082','6950079264'],
            ['86097','928','7703717852'],
            ['86017','69','3305055754'],
            ['86013','2281','7715597130'],
            ['85881','1977','5902202276'],
            ['85850','996','3123299570'],
            ['85704','620','7713076301'],
            ['85668','956','7715517791'],
            ['85612','996','7713076301'],
            ['85494','996','3123146862'],
            ['85450','1664','7725314920'],
            ['85375','996','3123034245'],
            ['85169','1130','6950028894'],
            ['85131','2281','5008038615'],
            ['85081','928','7126503125'],
            ['84787','2271','3128020567'],
            ['84582','750','6916009860'],
            ['84450','1040','2014023940'],
            ['84301','996','3123406133'],
            ['84196','1010','7605016030'],
            ['84054','2459','5008050299'],
            ['84041','750','9721009951'],
            ['84000','65','9721009951'],
            ['83859','2012','7726341892'],
            ['83820','1040','7709929211'],
            ['83763','1551','2320105623'],
            ['83645','1040','7810429070'],
            ['83638','996','312304134050'],
            ['83599','750','7707049388'],
            ['83573','1633','7723565630'],
            ['83569','750','6659121015'],
            ['83357','2337','7825098536'],
            ['83262','1652','7708503727'],
            ['83250','1082','695004344100'],
            ['83175','750','7717713079'],
            ['83117','1040','1653021456'],
            ['83097','1117','3123192080'],
            ['83093','750','7707049388'],
            ['83060','1130','771509470773'],
            ['83029','1040','5257133876'],
            ['83009','2281','7710140679'],
            ['82962','44','7701248637'],
            ['82823','2271','7709219099'],
            ['82655','1664','7812014560'],
            ['82645','1040','6672208730'],
            ['82624','2098','8091439841'],
            ['82514','1428','7723565630'],
            ['82439','65','7812014560'],
            ['82274','750','5048034110'],
            ['82273','750','2466249438'],
            ['82172','65','6204009267'],
            ['82170','65','7717127211'],
            ['81980','1889','7743895280'],
            ['81928','1684','504300789958'],
            ['81875','1040','7724833271'],
            ['81855','1040','2128031599'],
            ['81834','750','7812014560'],
            ['81797','1759','7721852685'],
            ['81790','928','7726648644'],
            ['81742','928','5024112009'],
            ['81551','750','6102025598'],
            ['81412','750','5011714485'],
            ['81318','928','7717127211'],
            ['81267','789','5074045157'],
            ['81264','65','690202630270'],
            ['81218','1040','7717605274'],
            ['81162','750','7707049388'],
            ['81133','1130','690302519519'],
            ['81132','1633','6952021446'],
            ['81048','189','5036065113'],
            ['81026','928','7736659109'],
            ['81001','750','7715733344'],
            ['80887','1040','7721852685'],
            ['80734','750','2463047909'],
            ['80661','65','7709219099'],
            ['80557','1082','690303281851'],
            ['80539','928','7839504883'],
            ['80535','1040','7702472896'],
            ['80496','928','7726341892'],
            ['80427','750','2466092240'],
            ['80426','750','2455020815'],
            ['80401','1833','7709219099'],
            ['80390','1326','7801413676'],
            ['80278','750','7703782611'],
            ['80264','1444','7710443169'],
            ['80189','996','3106007668'],
            ['80175','750','3446001409'],
            ['80105','928','7730640599'],
            ['80012','69','7801413676'],
            ['79950','1040','7701371574'],
            ['79929','1326','7723565630'],
            ['79875','1040','7717605274'],
            ['79846','26','690102071364'],
            ['79834','750','544307209873'],
            ['79816','1548','7710443169'],
            ['79800','NULL','7714158099'],
            ['79731','750','5612161081'],
            ['79673','1743','7707049388'],
            ['79570','928','7723755133'],
            ['79470','750','7751515221'],
            ['79289','1977','7807380096'],
            ['79207','750','3253000575'],
            ['79193','1769','771609561209'],
            ['79181','1130','6903007304'],
            ['79169','65','3664217260'],
            ['79121','1664','5036112765'],
            ['78972','69','7736196490'],
            ['78825','750','7812014560'],
            ['78762','928','7725290885'],
            ['78759','928','7725290902'],
            ['78588','1130','6916013305'],
            ['78547','750','3704000411'],
            ['78425','1633','6903007304'],
            ['78271','750','7735574734'],
            ['78269','750','5320015502'],
            ['78267','750','1658063121'],
            ['77087','928','7725275206'],
            ['77085','26','7726341892'],
            ['75597','750','3527013850'],
            ['75595','750','4218100297'],
            ['75549','1082','6950040563'],
            ['75511','750','5905275258'],
            ['75510','750','4807012604'],
            ['75357','65','3123165262'],
            ['75293','750','7707049388'],
            ['75203','1125','7709219099'],
            ['75180','65','7017162901'],
            ['75026','65','5039007624'],
            ['74991','996','3128047537'],
            ['74972','1977','6611013981'],
            ['74908','69','5030050311'],
            ['74905','65','7708503727'],
            ['74894','69','6102025598'],
            ['74744','69','5039007624'],
            ['74547','996','3123165262'],
            ['74238','1633','6952014424'],
            ['74159','69','6143084698'],
            ['74087','1130','6950185150'],
            ['73898','1664','7723714634'],
            ['73869','996','312303116436'],
            ['73831','1551','1644056131'],
            ['73817','1977','1515909342'],
            ['73775','1664','7017368973'],
            ['73700','996','7740000076'],
            ['73546','928','7710580334'],
            ['73421','996','3102021460'],
            ['73311','750','7707049388'],
            ['73270','65','3124014001'],
            ['73205','750','7707049388'],
            ['73107','750','7743895280'],
            ['73071','996','7743895280'],
            ['73052','928','7701759462'],
            ['73031','65','7714158099'],
            ['72892','1664','1901066023'],
            ['72891','1082','6950187164'],
            ['72774','1551','6211000057'],
            ['72603','1082','773424032252'],
            ['72507','1551','5006012650'],
            ['72506','1551','7604248952'],
            ['72452','750','2104007205'],
            ['72242','1769','3327823216'],
            ['72195','996','3102201671'],
            ['72150','1551','7713076301'],
            ['71997','2271','7714955136'],
            ['71933','69','7723565630'],
            ['71919','750','7713076301'],
            ['71827','1082','6901090917'],
            ['71819','1633','6901044798'],
            ['71815','996','3128082274'],
            ['71811','1040','7714720751'],
            ['71749','1082','6905053747'],
            ['71391','928','5027138855'],
            ['71390','1889','7703638142'],
            ['71326','750','2227022549'],
            ['71181','928','5048034110'],
            ['71105','750','7707049388'],
            ['71009','750','6454037010'],
            ['70976','682','772401956009'],
            ['70904','1082','6905081631'],
            ['70703','69','7707049388'],
            ['70677','1130','7708755629'],
            ['70552','2527','7703743429'],
            ['70420','69','7703616170'],
            ['70377','1082','6904029572'],
            ['70153','750','5042091506'],
            ['70077','750','7707049388'],
            ['70030','1082','7727635782'],
            ['69989','69','7722678655'],
            ['69872','996','6167108933'],
            ['69658','69','7731251901'],
            ['69530','1130','6952042069'],
            ['69186','69','5038042961'],
            ['69137','1941','5243024404'],
            ['69103','750','5615020233'],
            ['68974','750','7708724589'],
            ['68907','928','7709901199'],
            ['68871','1977','5902202276'],
            ['68866','1769','5029143603'],
            ['68783','750','3438008337'],
            ['68723','2271','5902202276'],
            ['68711','1551','5235006546'],
            ['68628','996','3123110760'],
            ['68503','1130','7707049388'],
            ['68362','750','7707049388'],
            ['68353','996','3124014001'],
            ['68225','1633','6901094100'],
            ['68060','750','3327322410'],
            ['67928','1977','4705018660'],
            ['67916','1977','2204049706'],
            ['67386','1082','6901071985'],
            ['67381','2344','7423000572'],
            ['67380','1082','6902018582'],
            ['67374','750','3664134279'],
            ['67314','69','5044072266'],
            ['67295','996','6901067107'],
            ['66947','1082','6952042069'],
            ['66945','1282','7325096266'],
            ['66900','750','6027118040'],
            ['66897','1130','690800327930'],
            ['65845','928','7714908866'],
            ['65827','1977','2127313086'],
            ['65632','750','7707049388'],
            ['65544','750','2308190284'],
            ['65526','750','7707049388'],
            ['65507','996','3121184020'],
            ['65421','2506','3128005752'],
            ['65397','928','7707491148'],
            ['65333','750','7707049388'],
            ['65187','750','7707049388'],
            ['64060','1633','6950116325'],
            ['64022','750','7707049388'],
            ['63982','750','7707049388'],
            ['63936','100','7714158099'],
            ['63921','69','7714158099'],
            ['61915','1130','5020071665'],
            ['61903','750','7707049388'],
            ['61859','750','7709219099'],
            ['61843','750','7707049388'],
            ['61837','750','7707049388'],
            ['61781','1130','6911027449'],
            ['61775','750','6831017477'],
            ['61773','1130','6908011784'],
            ['61658','1977','5407029556'],
            ['61397','660','6672212600'],
            ['61306','750','7707049388'],
            ['61266','69','5010026423'],
            ['61264','80','7701101088'],
            ['61100','1833','5029127753'],
            ['61062','1633','690141544141'],
            ['61054','996','3123180334'],
            ['61039','1130','7707049388'],
            ['60929','1130','6952000654'],
            ['60928','750','7714822810'],
            ['60865','928','7707115217'],
            ['60776','750','6452052044'],
            ['60681','1977','7448068879'],
            ['60107','1040','7722678655'],
            ['60071','750','3301013961'],
            ['60037','1082','6950146489'],
            ['59960','996','3123113384'],
            ['59855','928','7705529607'],
            ['59831','750','3334015026'],
            ['59825','1082','690402093009'],
            ['59704','996','3128072163'],
            ['59703','996','3123198540'],
            ['59605','928','7722742614'],
            ['59580','996','3128089632'],
            ['59563','996','7723565630'],
            ['59431','996','3102041957'],
            ['59292','996','3128072124'],
            ['59290','2337','7708503727'],
            ['59181','44','7730199840'],
            ['59170','996','7714158099'],
            ['59160','1082','6901016656'],
            ['59053','2271','3123124890'],
            ['59047','996','7812014560'],
            ['59035','750','5003077931'],
            ['59029','1082','7708755629'],
            ['58922','1117','7717127211'],
            ['58869','1664','5010035805'],
            ['58817','2271','3120098219'],
            ['58551','2271','7717127211'],
            ['58387','1833','7722820767'],
            ['58319','750','7707049388'],
            ['58149','1856','7707049388'],
            ['58129','44','500805088403'],
            ['58084','197','7718636099'],
            ['58015','1977','7740000076'],
            ['58000','996','3123148080'],
            ['57917','1977','6672287436'],
            ['57899','1833','5042091506'],
            ['57846','996','4101102302'],
            ['57831','2023','7707049388'],
            ['57775','2271','3128066522'],
            ['57731','750','1831084185'],
            ['57703','2459','7714955136'],
            ['57683','2271','3123281533'],
            ['57441','396','5021003629'],
            ['57350','2459','7728786216'],
            ['57312','1082','6950041711'],
            ['57282','996','3128030935'],
            ['57061','750','3301013961'],
            ['56984','1082','6950077073'],
            ['56904','996','3123108320'],
            ['56903','996','3123140885'],
            ['56834','2271','312302225200'],
            ['56806','1551','6625034290'],
            ['56549','750','7707049388'],
            ['56522','996','3123477342'],
            ['56362','750','4401006871'],
            ['56152','750','7707049388'],
            ['56071','750','7707049388'],
            ['56029','750','6623104104'],
            ['55949','1977','7709219099'],
            ['55907','750','1839003879'],
            ['55885','750','7707049388'],
            ['55852','928','5009061222'],
            ['55717','1082','6950029400'],
            ['55471','682','5030080958'],
            ['55413','750','2609019259'],
            ['55379','2195','7708715680'],
            ['55368','NULL','7728786216'],
            ['55343','1664','5038133016'],
            ['55178','1040','7704552473'],
            ['55119','750','2634081081'],
            ['55039','1977','6204009267'],
            ['54939','1977','7411058909'],
            ['54937','750','1655034059'],
            ['54818','750','2303025304'],
            ['54816','2195','7703649183'],
            ['54784','750','2609019259'],
            ['54780','69','7812014560'],
            ['54627','750','7707049388'],
            ['54552','1082','6952030257'],
            ['54416','750','7707049388'],
            ['54341','750','2635100562'],
            ['54217','928','7705194654'],
            ['54175','1633','6950025780'],
            ['54080','750','7453032028'],
            ['53724','750','5029127753'],
            ['53641','1082','690204174601'],
            ['53541','682','5032259125'],
            ['53526','1130','5401210999'],
            ['53373','1082','6949004708'],
            ['53307','750','5003099438'],
            ['53292','928','7715794940'],
            ['53290','69','7715517791'],
            ['52855','789','7705451686'],
            ['52842','1633','9723040900'],
            ['52806','928','7717039300'],
            ['52797','44','7708162481'],
            ['52738','2004','7705194654'],
            ['52413','1633','6901075362'],
            ['52390','1130','6950061549'],
            ['52308','750','5028021634'],
            ['52292','928','7725709407'],
            ['51789','750','7714955136'],
            ['51600','1130','6950079264'],
            ['51560','1033','7708503727'],
            ['51365','750','5009081613'],
            ['51330','928','7704241848'],
            ['51191','928','7704757858'],
            ['51077','585','7744000912'],
            ['50774','2281','7705194654'],
            ['50660','69','7709219099'],
            ['50611','393','5402046082'],
            ['50610','750','6629025554'],
            ['50398','1664','2128031599'],
            ['50383','789','772738195721'],
            ['50347','1130','5902202276'],
            ['50298','750','5011031521'],
            ['50279','1833','7709219099'],
            ['50195','69','7704180377'],
            ['50164','750','7327049769'],
            ['50138','1258','7707049388'],
            ['50025','1664','5023000616'],
            ['49989','69','5020030860'],
            ['49885','1633','6952018612'],
            ['49686','44','5029163670'],
            ['49390','870','5020030860'],
            ['49366','996','3123178261'],
            ['49363','2362','3123034245'],
            ['49091','928','7736222260'],
            ['49078','750','7718701365'],
            ['48976','870','7722678655'],
            ['48790','1040','7703136921'],
            ['48527','2281','7709500060'],
            ['48390','1326','7713076301'],
            ['48255','1040','7729770762'],
            ['48249','928','7704691974'],
            ['48235','1040','7704720689'],
            ['48196','928','7726648644'],
            ['48095','789','5003054758'],
            ['47797','1633','690500162268'],
            ['47679','789','5003071295'],
            ['47452','100','5408243746'],
            ['47413','1040','7703529560'],
            ['47116','1633','6903039578'],
            ['45914','789','7744000912'],
            ['45566','750','3702087103'],
            ['45541','144','7714158099'],
            ['45491','238','7717127211'],
            ['45262','750','7604178825'],
            ['44942','1082','6950101784'],
            ['44588','44','7730199840'],
            ['44571','189','7722765428'],
            ['44497','1633','6901089140'],
            ['44323','750','5037042937'],
            ['44110','1664','7728247278'],
            ['43201','1040','7731645568'],
            ['43140','816','7716143718'],
            ['43106','1326','5902202276'],
            ['42924','1882','7714270990'],
            ['42789','1633','6950103453'],
            ['42707','750','4632030790'],
            ['42650','1833','7812014560'],
            ['41918','238','7104068581'],
            ['41747','1082','7717127211'],
            ['41372','928','7717029599'],
            ['40770','1633','6900000075'],
            ['39722','789','507460680305'],
            ['39696','1326','7714158099'],
            ['39589','1082','6950087667'],
            ['39362','529','7707049388'],
            ['39023','1130','6901067107'],
            ['38979','1130','6900000075'],
            ['38945','1040','7707115217'],
            ['38855','2527','7719737445'],
            ['38743','1130','7708503727'],
            ['38540','431','7708503727'],
            ['38435','1960','5040114973'],
            ['38375','996','3128025082'],
            ['38184','1396','7715110597'],
            ['38149','1130','7707049388'],
            ['38057','682','772804532098'],
            ['37907','586','7708503727'],
            ['37829','1743','7705451686'],
            ['37459','251','7708503727'],
            ['37330','238','3664217260'],
            ['36282','1833','7729670341'],
            ['36268','682','5030062300'],
            ['35846','44','7710950948'],
            ['35049','819','7707049388'],
            ['34962','216','7714158099'],
            ['34932','189','7704498522'],
            ['34676','144','7707049388'],
            ['34455','2459','5902202276'],
            ['34367','750','5036067583'],
            ['33880','682','5032225239'],
            ['30184','1633','7733678449'],
            ['30156','1082','6904025426'],
            ['30154','682','5032137342'],
            ['29896','69','4025045699'],
            ['29868','189','7708503727'],
            ['29867','1424','7708503727'],
            ['29391','750','7706538467'],
            ['29384','1082','6950041711'],
            ['29317','1082','6950160934'],
            ['29311','2281','7713537305'],
            ['29308','682','5032199902'],
            ['29304','682','503000792820'],
            ['29240','682','5030084600'],
            ['29161','1633','6952041668'],
            ['29091','750','5034020942'],
            ['28935','2459','5008050299'],
            ['28830','1633','690202630270'],
            ['28829','1130','6950087160'],
            ['28789','393','7707049388'],
            ['28753','393','7707049388'],
            ['28691','1','7702014159'],
            ['28689','1040','5010026423'],
            ['28652','682','5030007884'],
            ['28338','238','7717127211'],
            ['28017','433','5030046266'],
            ['27800','1664','7116006212'],
            ['27719','682','5030046266'],
            ['27617','1130','690200529571'],
            ['27516','2264','7715794940'],
            ['27435','262','7812014560'],
            ['27225','216','7722678655'],
            ['27162','750','5003071714'],
            ['27016','1833','5050057322'],
            ['27006','2271','3666077347'],
            ['27003','1977','7707049388'],
            ['26806','750','7707049388'],
            ['26769','750','5003053909'],
            ['26564','750','6319169115'],
            ['26450','750','5017040995'],
            ['26366','1','7708503727'],
            ['26365','1','6231004437'],
            ['26364','453','7707049388'],
            ['26301','1','7710016640'],
            ['26286','1','7708503727'],
            ['26280','1','7710016640'],
            ['26279','1','7708000882'],
            ['26276','1','7708503727'],
            ['26270','1','7710016640'],
            ['26264','69','4632193548'],
            ['26259','1','7713539045'],
            ['26241','358','3128025082'],
            ['26223','682','507500054032'],
            ['26218','358','7708503727'],
            ['26202','750','7707049388'],
            ['25555','750','5042010200'],
            ['25410','1653','5407029556'],
            ['25310','80','7716550015'],
            ['25234','69','7802319940'],
            ['25232','2459','7707049388'],
            ['25214','750','5032242756'],
            ['25123','750','4502013089'],
            ['25103','68','3126017110'],
            ['25081','750','4501082097'],
            ['25077','750','4253022764'],
            ['25044','68','1831084185'],
            ['25038','750','5902202276'],
            ['25036','238','7740000076'],
            ['25034','750','6231004437'],
            ['24985','750','7202149648'],
            ['24940','750','3448025853'],
            ['24930','1977','3666174710'],
            ['24903','750','1681000024'],
            ['24851','68','2466092240'],
            ['24838','69','7812014560'],
            ['24802','69','7816181675'],
            ['24592','238','7816181675'],
            ['24539','2357','7712038455'],
            ['24300','393','7707049388'],
            ['23970','682','5036065113'],
            ['23910','68','6659121015'],
            ['23857','144','5000000970'],
            ['23856','2271','7707049388'],
            ['23826','227','5029075914'],
            ['23806','996','3102020467'],
            ['23734','2271','7708503727'],
            ['23730','996','3123433521'],
            ['23711','1833','7715354219'],
            ['23709','996','3127000014'],
            ['23661','928','7710582109'],
            ['23558','2459','5902202276'],
            ['23460','1','7740000076'],
            ['22304','1551','4214004610'],
            ['22294','197','7710657509'],
            ['22243','2459','7736176197'],
            ['22230','238','6659121015'],
            ['22213','238','7709219099'],
            ['22146','1833','7810204213'],
            ['21845','1833','7812014560'],
            ['21792','69','7709229629'],
            ['21665','1653','7715354219'],
            ['21608','69','7731251901'],
            ['21533','819','7736176197'],
            ['21480','44','7708503727'],
            ['21029','1326','7816181675'],
            ['21013','44','7708503727'],
            ['20451','682','5075031982'],
            ['20302','819','7825098536'],
            ['18835','1833','7812014560'],
            ['18590','2459','7713076301'],
            ['18342','1977','4025045699'],
            ['18321','69','7714614785'],
            ['17992','NULL','7708503727'],
            ['17973','44','5041024698'],
            ['17777','750','5528009730'],
            ['17763','2459','7707049388'],
            ['17698','1833','7710016640'],
            ['17615','649','2466249438'],
            ['17598','750','7710030404'],
            ['17282','68','3128020567'],
            ['17269','238','3702087103'],
            ['17258','238','7713654489'],
            ['17180','80','7728132566'],
            ['17134','682','7708503727'],
            ['17125','1769','7712026280'],
            ['17029','68','6452052044'],
            ['16938','2459','7723565630'],
            ['16892','1977','5406202222'],
            ['16807','750','5024020887'],
            ['16626','1882','7714158099'],
            ['16562','819','7713222880'],
            ['16529','1048','7709219099'],
            ['16400','750','7736196490'],
            ['16397','819','7720518656'],
            ['16394','819','7702172300'],
            ['16390','1130','6944006405'],
            ['16273','819','7707049388'],
            ['16252','69','7722678655'],
            ['16240','2459','5031018470'],
            ['16226','2357','7714037739'],
        ];


        echo '<pre>';

        $managersMap = [];

        for($a = 0, $len = sizeof($array); $a < $len; $a++) {
            list($sdCustomerId, $sdManagerId, $sdInn) = $array[$a];

            $counterAgent = $this->db->query(
                'SELECT counteragent_id FROM pm.counteragent_requisite WHERE requisite_inn = :inn',
                [
                    'inn' => $sdInn
                ]
            )->fetch();

            if (!$counterAgent) {
                continue;
            }

            $counterAgentId = (int)$counterAgent['counteragent_id'];

            if (!isset($managersMap[$sdManagerId])) {
                $managersMap[$sdManagerId] = (int)$this->db->query(
                    'SELECT member_id FROM integration.external_member AS em WHERE external_member_id=:mid AND external_id = 1',
                    ['mid' => $sdManagerId]
                )->fetch()['member_id'] ?? 0;
            }

            $this->db->query(
                '
                    INSERT INTO integration.external_counteragent (external_id, counteragent_id, external_counteragent_id)
                    VALUES(:eid, :cid, :ecid)
                    ON CONFLICT(external_id, counteragent_id)
                    DO UPDATE SET external_counteragent_id = EXCLUDED.external_counteragent_id
                ',
                [
                    'eid' => 1,
                    'cid' => $counterAgentId,
                    'ecid' => $sdCustomerId
                ]
            );

            if ($managersMap[$sdManagerId]) {
                $this->db->query(
                    '
                        UPDATE pm.counteragent
                        SET manager_member_id = :mid
                        WHERE counteragent_id = :cid
                    ',
                    [
                        'mid' => $managersMap[$sdManagerId],
                        'cid' => $counterAgentId
                    ]
                );
            }
        }





        $this->view->disable();
        exit;
    }

    public function fillAgentsAction() {
        $agentsData = [
            ['73032','65','0105052856'],
            ['89963','1664','0263012969'],
            ['93794','1664','0276118419'],
            ['77566','1664','0276162626'],
            ['94140','2012','0278109628'],
            ['69812','750','0400008188'],
            ['112525','2098','0603009927'],
            ['81609','750','0725000921'],
            ['82079','750','0816001584'],
            ['101213','1977','1001054385'],
            ['72226','69','1001137458'],
            ['89841','1664','1103042163'],
            ['91132','1856','1106022398'],
            ['110269','1977','1402025952'],
            ['17880','216','1502024744'],
            ['73831','1551','1644056131'],
            ['54937','750','1655034059'],
            ['78267','750','1658063121'],
            ['24903','750','1681000024'],
            ['70688','750','1829014279'],
            ['57731','750','1831084185'],
            ['93637','26','1831159930'],
            ['55907','750','1839003879'],
            ['72892','1664','1901066023'],
            ['72452','750','2104007205'],
            ['111071','1664','2124025080'],
            ['81855','1664','2128031599'],
            ['67916','1977','2204049706'],
            ['112788','69','2221228776'],
            ['71326','750','2227022549'],
            ['54818','750','2303025304'],
            ['93197','1664','2306003330'],
            ['65544','750','2308190284'],
            ['104611','1977','2308267138'],
            ['110673','1977','2309132711'],
            ['98792','1664','2310171761'],
            ['109405','1977','2310194536'],
            ['113293','69','2310213852'],
            ['86987','750','2315088972'],
            ['94609','1664','2315127639'],
            ['83763','1551','2320105623'],
            ['99363','1977','2320225984'],
            ['102724','69','232300737315'],
            ['96377','1977','2373012436'],
            ['25116','69','2443019893'],
            ['80426','750','2455020815'],
            ['92338','1664','2456009733'],
            ['19500','1895','2461042849'],
            ['101460','1664','246215439093'],
            ['111340','1977','2463240412'],
            ['102869','1664','2465234238'],
            ['80427','750','2466092240'],
            ['58345','393','2466220319'],
            ['82273','750','2466249438'],
            ['20644','393','2540096163'],
            ['55413','750','2609019259'],
            ['104139','1551','2627022215'],
            ['112387','2098','2631804230'],
            ['72386','1130','2632070694'],
            ['55119','750','2634081081'],
            ['54341','750','2635100562'],
            ['102887','1977','2636033069'],
            ['88704','69','3015062598'],
            ['95270','1895','3017045365'],
            ['78606','996','3123227624'],
            ['78953','996','3123312502'],
            ['103396','2271','3127005630'],
            ['79207','750','3253000575'],
            ['88921','26','3257009280'],
            ['60071','750','3301013961'],
            ['86017','69','3305055754'],
            ['69820','750','3316017863'],
            ['61247','69','3321026408'],
            ['59831','750','3334015026'],
            ['68783','750','3438008337'],
            ['49329','750','3442056982'],
            ['80175','750','3446001409'],
            ['109198','1664','3525150820'],
            ['92602','1664','3525338684'],
            ['111394','1995','3525385324'],
            ['75597','750','3527013850'],
            ['102578','1664','3528171360'],
            ['24063','1833','3662124236'],
            ['44174','238','3662209835'],
            ['67374','750','3664134279'],
            ['101028','1977','3664209020'],
            ['27006','2271','3666077347'],
            ['91238','1977','3666152146'],
            ['24930','1977','3666174710'],
            ['45566','750','3702087103'],
            ['78547','750','3704000411'],
            ['90611','26','3818018300'],
            ['104100','1977','4003016140'],
            ['93844','1977','401700353413'],
            ['29896','1977','4025045699'],
            ['87644','1664','4202052288'],
            ['24883','750','4205025388'],
            ['44438','1977','4205036414'],
            ['75595','750','4218100297'],
            ['25077','750','4253022764'],
            ['109271','1664','4307012412'],
            ['97652','1664','4345079182'],
            ['56362','750','4401006871'],
            ['93060','1856','4401088176'],
            ['57955','750','4401097188'],
            ['95394','1664','4401161027'],
            ['25081','750','4501082097'],
            ['25085','750','4501084048'],
            ['25123','750','4502013089'],
            ['42707','750','4632030790'],
            ['104882','1977','4632061534'],
            ['103491','996','4632193548'],
            ['70032','69','4702008689'],
            ['69936','69','4702010350'],
            ['72607','1664','4703041618'],
            ['110105','2098','4703113622'],
            ['111503','1977','4704029839'],
            ['67928','1977','4705018660'],
            ['72606','69','4705031326'],
            ['56890','69','4706021088'],
            ['73021','69','4706022684'],
            ['72551','69','4710025230'],
            ['95357','69','4715018236'],
            ['75510','750','4807012604'],
            ['98137','1664','4824081559'],
            ['93077','1664','5001096463'],
            ['110789','1048','500121009259'],
            ['26769','750','5003053909'],
            ['58674','928','5003063054'],
            ['50268','1664','5003076310'],
            ['59035','750','5003077931'],
            ['100006','2098','5003086277'],
            ['53307','750','5003099438'],
            ['89419','26','5004016441'],
            ['49135','870','5005061454'],
            ['38208','1664','5006008140'],
            ['72507','1551','5006012650'],
            ['84500','1833','5007044493'],
            ['29020','928','5008033303'],
            ['84054','2459','5008050299'],
            ['55852','928','5009061222'],
            ['51365','750','5009081613'],
            ['61266','1040','5010026423'],
            ['99607','1664','5010035805'],
            ['104322','1977','5010041894'],
            ['87391','69','5010050793'],
            ['50298','750','5011031521'],
            ['21255','2459','5013032111'],
            ['104125','2098','5013053231'],
            ['24701','750','5015007791'],
            ['51421','1664','5016013170'],
            ['26450','750','5017040995'],
            ['22822','2459','5018206241'],
            ['111050','1833','5020030475'],
            ['49989','870','5020030860'],
            ['61915','1130','5020071665'],
            ['81104','789','5021013232'],
            ['50566','69','5022045100'],
            ['50025','1664','5023000616'],
            ['16807','750','5024020887'],
            ['108933','2098','5024055463'],
            ['27916','2459','5024073102'],
            ['102770','1551','5024124170'],
            ['112594','1977','5024144480'],
            ['110302','1977','5025023834'],
            ['84505','1833','5027120657'],
            ['81913','750','5027120738'],
            ['52308','750','5028021634'],
            ['92531','26','5029070793'],
            ['61100','1833','5029127753'],
            ['21203','2459','5029141042'],
            ['112363','1833','5029143963'],
            ['24709','750','5029145978'],
            ['81983','1833','5029206035'],
            ['28017','682','5030046266'],
            ['74908','69','5030050311'],
            ['26071','69','5030053930'],
            ['96602','1664','5030072298'],
            ['16240','2459','5031018470'],
            ['24724','69','5031113123'],
            ['99812','1833','5032130932'],
            ['48864','928','5032221805'],
            ['80935','1833','5032225937'],
            ['25214','750','5032242756'],
            ['93069','80','5032289560'],
            ['29091','750','5034020942'],
            ['34367','750','5036067583'],
            ['100041','1977','5036083507'],
            ['94985','1664','5036112765'],
            ['109576','1664','5036116657'],
            ['104688','2098','5036133437'],
            ['44323','750','5037042937'],
            ['69186','69','5038042961'],
            ['89771','750','5038088765'],
            ['55343','1664','5038133016'],
            ['75026','69','5039007624'],
            ['99664','750','5040073205'],
            ['36446','1977','5040075820'],
            ['113035','2098','5040125118'],
            ['25555','750','5042010200'],
            ['111767','1664','5042057833'],
            ['70153','1833','5042091506'],
            ['28661','69','5042096783'],
            ['48405','928','5043020667'],
            ['113411','1551','5043036924'],
            ['95657','789','5043041459'],
            ['112763','1995','5043075306'],
            ['67314','69','5044072266'],
            ['109025','1977','5045031713'],
            ['16280','2459','5046042235'],
            ['18436','750','5047002154'],
            ['111701','1664','5047155760'],
            ['28107','750','5047187138'],
            ['82274','928','5048034110'],
            ['28024','1833','5050020139'],
            ['22821','1833','5050048938'],
            ['27016','1833','5050057322'],
            ['104751','1664','5050109690'],
            ['114641','1786','5050114725'],
            ['90615','26','5052013497'],
            ['71585','1130','5055002574'],
            ['98819','2098','5056000107'],
            ['98041','1664','5056006814'],
            ['90613','1664','5075018999'],
            ['67348','928','5075024417'],
            ['92142','26','5243015625'],
            ['111755','2098','5244019051'],
            ['112138','1995','5245015772'],
            ['103646','1977','5247046423'],
            ['109582','2098','5252019915'],
            ['91630','1977','5260310564'],
            ['72160','69','5260343182'],
            ['97602','2098','5262067308'],
            ['78269','750','5320015502'],
            ['95093','393','5402046082'],
            ['52833','750','5404227535'],
            ['112089','1833','5408185212'],
            ['79834','750','544307209873'],
            ['99310','1664','5445024710'],
            ['78087','750','5504084256'],
            ['78119','750','5504122776'],
            ['17777','750','5528009730'],
            ['102573','2098','5603042137'],
            ['79731','750','5612161081'],
            ['79168','65','5614073056'],
            ['89591','2459','5902202276'],
            ['85302','1540','5904242027'],
            ['75511','750','5905275258'],
            ['110587','2098','5920029970'],
            ['93078','26','6025030537'],
            ['112592','1977','6027012974'],
            ['69469','750','6027058672'],
            ['103835','26','6027083245'],
            ['81551','750','6102025598'],
            ['92131','26','6125032030'],
            ['98181','1977','6141057201'],
            ['97993','2098','6143049372'],
            ['74159','69','6143084698'],
            ['91140','1664','615421690390'],
            ['81630','750','6161046649'],
            ['104207','2098','6164126853'],
            ['26817','393','6168021153'],
            ['82172','1977','6204009267'],
            ['72774','1551','6211000057'],
            ['26365','750','6231004437'],
            ['82531','65','6316136295'],
            ['102660','1664','6319225514'],
            ['24619','750','6320006309'],
            ['89736','1428','6367038835'],
            ['103779','1977','6443021868'],
            ['60776','750','6452052044'],
            ['55782','750','6606022606'],
            ['98937','1977','6611013981'],
            ['103914','2098','6617013890'],
            ['97848','1977','6619016800'],
            ['56029','750','6623104104'],
            ['91129','26','6658439479'],
            ['24812','750','6662103947'],
            ['69807','750','6665002866'],
            ['24837','68','6670019135'],
            ['86279','750','6670309204'],
            ['24606','238','6671175225'],
            ['61397','660','6672212600'],
            ['90616','1977','6678061918'],
            ['97225','2098','6681005215'],
            ['108893','2098','6682002175'],
            ['101266','1977','6725012156'],
            ['24980','750','6730042163'],
            ['69675','750','6828005778'],
            ['61775','750','6831017477'],
            ['21490','750','6901006111'],
            ['91131','26','6901027249'],
            ['47645','750','6910015465'],
            ['84582','750','6916009860'],
            ['91138','1130','6950064010'],
            ['112279','238','6952319842'],
            ['99235','1664','7002013858'],
            ['96586','1977','7017016869'],
            ['73775','1664','7017368973'],
            ['73046','65','7021044001'],
            ['60853','1428','7107052212'],
            ['99018','1977','7107089389'],
            ['92101','238','7107115529'],
            ['27800','1664','7116006212'],
            ['96973','1664','7117501097'],
            ['91136','26','7136501720'],
            ['94729','1977','7202128430'],
            ['91470','26','7202204419'],
            ['81074','65','7204087429'],
            ['79760','1977','720414745909'],
            ['94244','1664','7325096266'],
            ['50164','750','7327049769'],
            ['54939','1977','7411058909'],
            ['60681','1977','7448068879'],
            ['91072','1664','7448079060'],
            ['103093','1977','7451195115'],
            ['54080','750','7453032028'],
            ['101066','1664','7604091130'],
            ['45262','750','7604178825'],
            ['72506','1551','7604248952'],
            ['99685','633','7610063477'],
            ['108882','1484','7701101088'],
            ['59204','1653','7701290149'],
            ['66893','682','7701312730'],
            ['72485','69','7701912745'],
            ['16734','1833','7702029405'],
            ['16394','819','7702172300'],
            ['91086','2357','7702383780'],
            ['88777','1833','7702387055'],
            ['19978','1833','7702388235'],
            ['93342','1664','7703059410'],
            ['90608','1977','7703425754'],
            ['95822','1010','7703534295'],
            ['70420','69','7703616170'],
            ['74909','65','7703779520'],
            ['80278','750','7703782611'],
            ['84561','2459','770404248071'],
            ['82541','1977','7704152556'],
            ['50195','69','7704180377'],
            ['27585','2459','7704197236'],
            ['113163','2098','7704208760'],
            ['97037','1664','7704426260'],
            ['93633','26','7704651869'],
            ['113302','69','7704848336'],
            ['16447','69','7705017253 '],
            ['21938','1977','7705348791'],
            ['52855','1743','7705451686'],
            ['72871','1960','7706019535'],
            ['96590','2459','7706433175'],
            ['29391','750','7706538467'],
            ['113892','2459','7707049388'],
            ['99487','1977','7707706516'],
            ['38853','393','7707715503'],
            ['16347','2459','7708095080'],
            ['103030','1977','7708338583'],
            ['98489','2459','7708355500'],
            ['68974','750','7708724589'],
            ['41980','649','7708738912'],
            ['102840','1551','7708781107'],
            ['113459','2271','7709219099'],
            ['21792','1977','7709229629'],
            ['23478','1743','7709342342'],
            ['103834','26','7709362765'],
            ['51397','1977','7709562556'],
            ['67539','2459','7709731275'],
            ['90408','1833','7710016640'],
            ['17598','750','7710030404'],
            ['16946','2459','7710146208'],
            ['28972','750','7710383375'],
            ['16421','1833','7710436796'],
            ['22325','649','7710456087'],
            ['94510','1444','7710550185'],
            ['30082','216','7710635216'],
            ['53314','1833','7710728559'],
            ['104582','928','7710918800'],
            ['111392','1995','7710965662'],
            ['24539','2357','7712038455'],
            ['102846','1551','7713076301'],
            ['81011','69','7713417960'],
            ['92716','1664','7713654489'],
            ['79159','928','7714117938'],
            ['25731','216','7714389762'],
            ['100229','2098','7714448425'],
            ['16802','2185','7714533600'],
            ['24767','750','7714541576'],
            ['60928','750','7714822810'],
            ['96058','2459','7714955136'],
            ['16822','2459','7715227394'],
            ['94192','1833','7715255320'],
            ['30201','69','7715296373'],
            ['90633','1833','7715354219'],
            ['85668','956','7715517791'],
            ['81001','750','7715733344'],
            ['36195','1833','7715755732'],
            ['52699','69','7715765138'],
            ['97187','1977','7715791593'],
            ['67137','69','7715904744'],
            ['19570','1833','7716207224'],
            ['34226','1833','7716219981'],
            ['94511','1664','7716513239'],
            ['86983','1664','7716559138'],
            ['99883','1833','7716670545'],
            ['16737','2459','7717020170'],
            ['82170','2271','7717127211'],
            ['88916','1664','7717284782'],
            ['16988','1833','7717502046'],
            ['83175','750','7717713079'],
            ['99618','2098','7718293170'],
            ['49078','750','7718701365'],
            ['80499','2459','7718766718'],
            ['91471','1664','7719403594'],
            ['82435','1428','7719408546'],
            ['98059','2098','7719571687'],
            ['111915','1664','7719738150'],
            ['18227','1977','7720238313'],
            ['94054','1833','7720595499'],
            ['112985','539','7720688986'],
            ['29153','1833','7721237513'],
            ['82169','1664','7722269116'],
            ['79637','2459','7722553712'],
            ['98282','2098','7722624201'],
            ['39197','2459','7722624970'],
            ['69989','1040','7722678655'],
            ['71756','2357','7722698789'],
            ['45453','1428','7722747524'],
            ['58387','1833','7722820767'],
            ['61123','1551','7723614125'],
            ['94638','69','7723663732'],
            ['110569','2098','7724768576'],
            ['29114','819','7725153180'],
            ['85450','1664','7725314920'],
            ['80841','1833','7725545445'],
            ['100561','1664','7725665044'],
            ['101019','1833','7726525466'],
            ['99315','1664','7726535270'],
            ['79512','1664','7726545230'],
            ['98046','1977','7727395481'],
            ['44110','1664','7728247278'],
            ['91480','26','7728429849'],
            ['67169','197','7728544305'],
            ['100272','1977','7728623099'],
            ['113276','2459','7728628139'],
            ['23614','750','7728715529'],
            ['57350','2459','7728786216'],
            ['82403','216','7728845983'],
            ['21032','819','7729342140'],
            ['101363','1977','7729445995'],
            ['94373','1833','7729670341'],
            ['69658','69','7731251901'],
            ['93538','1664','773128218747'],
            ['29040','819','7731604593'],
            ['17341','2459','7731659962'],
            ['97710','1833','7733275344'],
            ['100414','1664','7733806972'],
            ['112307','2459','773388384496'],
            ['49300','928','7735104182'],
            ['80800','750','7735143350'],
            ['20348','2459','7735504575'],
            ['112649','1664','7735572247'],
            ['78271','750','7735574734'],
            ['109769','69','773574497440'],
            ['78972','750','7736196490'],
            ['104855','1833','7736656394'],
            ['111041','1977','7737128894'],
            ['94848','2012','7740000020'],
            ['100965','2098','7740000076'],
            ['25165','1833','7743054859'],
            ['89121','1664','7743085617'],
            ['84529','1833','7743195070'],
            ['48021','750','7743530434'],
            ['81980','1889','7743895280'],
            ['98659','1977','7751082560'],
            ['79470','750','7751515221'],
            ['70998','1326','7801176986'],
            ['92451','1977','7801194600'],
            ['80390','1326','7801413676'],
            ['90198','1326','7801590844'],
            ['103644','2126','7801651230'],
            ['99890','1664','7802184161'],
            ['68738','1326','7802313561'],
            ['25234','69','7802319940'],
            ['91501','69','7804164876'],
            ['92420','1664','7804391999'],
            ['99454','1977','7805693488'],
            ['86157','69','7806326642'],
            ['96935','69','7806379884'],
            ['17120','649','7808007715'],
            ['22146','1833','7810204213'],
            ['109182','2098','7810392542'],
            ['100995','1664','7810481802'],
            ['46320','2459','7810524485'],
            ['102735','2098','7810730664'],
            ['55193','928','7811152127'],
            ['98637','1664','7811396885'],
            ['37374','80','7811404769'],
            ['82655','1833','7812014560'],
            ['91516','1326','7813412719'],
            ['93267','1977','7813445263'],
            ['99120','1664','7814327760'],
            ['33170','69','7814412180'],
            ['95782','69','7814534043'],
            ['112251','2142','7814551360'],
            ['18778','2459','7816055208'],
            ['24802','1326','7816181675'],
            ['83231','1326','7816223580'],
            ['97508','26','7816689765'],
            ['61765','69','7817304030'],
            ['96036','2337','7825098536'],
            ['52295','1326','7825365252'],
            ['49516','840','7825467769'],
            ['95196','69','7826027383'],
            ['74011','69','7838492138'],
            ['50749','2098','7839443020'],
            ['102962','1977','7839495100'],
            ['99651','26','7840464498'],
            ['113986','26','7842002393'],
            ['38564','819','7842393933'],
            ['101275','1664','7842437002'],
            ['22285','216','8602146876'],
            ['99064','1757','9204005780'],
            ['94496','1895','9701059753'],
            ['111848','2098','9704119665'],
            ['85548','1743','9715237854'],
            ['93061','1664','9715248863'],
            ['108936','1664','9717010270'],
            ['97666','2459','9718148433'],
            ['84041','750','9721009951'],
            ['111081','1977','9724039640'],
            ['86551','1757','9909125356']
        ];

        $managersMap = [];

        for($a = 0, $len = sizeof($agentsData); $a < $len; $a++) {
            list($sdCustomerId, $sdManagerId, $inn) = $agentsData[$a];

            if (!$inn) {
                echo $sdCustomerId.',';
                continue;
            }

            if ($this->db->query(
                '
                    SELECT 1 
                    FROM integration.external_counteragent
                    WHERE external_id = :eid
                      AND external_counteragent_id = :ecid
                ',
                [
                    'eid' => 1,
                    'ecid' => $sdCustomerId
                ]
            )->fetch()) {
                continue;
            }

            echo $sdCustomerId.',';


            sleep(1);
            $daDataRes = $this->daData->findById('party', $inn);

            if (!sizeof($daDataRes)) {
                continue;
            }

            if (!isset($managersMap[$sdManagerId])) {
                $managersMap[$sdManagerId] = (int)$this->db->query(
                    'SELECT member_id FROM integration.external_member AS em WHERE external_member_id=:mid AND external_id = 1',
                    ['mid' => $sdManagerId]
                )->fetch()['member_id'] ?? 0;
            }


            $data = $daDataRes[0]['data'];
            $memberId = !$managersMap[$sdManagerId] ? $this->user->getId() : $managersMap[$sdManagerId];

            $title = $data['name']['short_with_opf'];

            $counterAgentId = ((int)$this->db->query(
                'SELECT pm.counteragent_create(:mid, :tit::varchar(512), :ddt::jsonb) AS res',
                [
                    'mid' => $memberId,
                    'tit' => $title,
                    'ddt' => json_encode($data)
                ]
            )->fetch()['res']);

            $this->db->query(
                '
                    INSERT INTO integration.external_counteragent (external_id, counteragent_id, external_counteragent_id)
                    VALUES(:eid, :cid, :ecid)
                    ON CONFLICT(external_id, counteragent_id)
                    DO UPDATE SET external_counteragent_id = EXCLUDED.external_counteragent_id
                ',
                [
                    'eid' => 1,
                    'cid' => $counterAgentId,
                    'ecid' => $sdCustomerId
                ]
            );

            echo $counterAgentId.' - added <br>';
        }

        exit;
    }

    public function recheckExistingAction() {
        $etalonInn = ['2221228776','6143084698','720414745909','7728628139','7703616170','5408185212','7743195070','7704180377','5027120657','7721237513','7737128894','7710965662','5003099438','5038042961','5038088765','7107115529','2309132711','5024124170','7728544305','4501082097','7713654489','5244019051','6204009267','1901066023','7708781107','7743530434','6901006111','5902202276','7703425754','4704029839','1402025952','5031113123','7813445263','7710030404','3017045365','7002013858','6829063892','7814551360','7610063477','7731251901','3525385324','0274018377','4202052288','2303025304','7743054859','7715755732','3525338684','7702383780','7801590844','5042091506','5042096783','5320015502','5036083507','7813412719','5038067740','5036133437','2204049706','7713417960','4706022684','5020030860','6682002175','7729445995','7702388235','7730173256','7842002393','3334015026','3662209835','7720595499','5247046423','3327138490','773574497440','0278109628','7703782611','7718766718','7709219099','4702008689','3664209020','5612161081','4703113622','7713076301','7839443020','7740000020','5043036924','7839495100','5040125118','5009061222','5020071665','7715791593','1829014279','5021013232','7814412180','7715227394','5032130932','3704000411','7725665044','770404248071','4307012412','7717713079','7751082560','2631804230','7728786216','5001096463','615421690390','5029141042','4345079182','5905275258','500121009259','5008033303','7722624970','7707706516','9204005780','5056006814','9718113688','3123227624','6950064010','7714533600','5009081613','2310213852','5030050311','246215439093','9701059753','7701290149','6671175225','4205025388','5011031521','5030072298','4807012604','4824081559','7017368973','0276162626','7735572247','5015007791','5016013170','5262067308','2466092240','1831084185','7021044001','7715904744','5050114725','7716559138','5003086277','9721009951','5036057634','5038133016','5050048938','7701912745','6662103947','7411058909','5043075306','5029070793','7718701365','7733806972','5040075820','3702087103','3666174710','4401097188','9715237854','7136501720','4632030790','6619016800','6681005215','7453032028','7448068879','7448079060','5075018999','2627022215','6670309204','7202204419','4710025230','4710025230','6320006309','7716207224','5039007624','3666077347','3666152146','5036067583','7708355500','7806326642','401700353413','773128218747','544307209873','471900258592','7715733344','1502024744','7736196490','7736196490','5017040995','4705031326','5243015625','5243015625','7814327760','7715296373','3662124236','7825098536','6025030537','4401006871','3316017863','5029143963','5260310564','2373012436','7708724589','3305055754','7817304030','7717502046','7728247278','7717020170','7701312730','5046042235','7716513239','7725314920','2104007205','7720688986','7709219099','4632061534','7704651869','7735104182','7802313561','7718293170','7810524485','6623104104','6611013981','5030046266','5905301420','2310171761','5036112765','232300737315','7842437002','5006012650','7705451686','2455020815','6367038835','5042057833','4205036414','4632193548','4502013089','220408669318','2632070694','6141057201','5050057322','7710918800','6910015465','6829003413','7703779520','7719571687','5007044493','5025023834','7714448425','7713339141','5024144480','7708095080','7723663732','5008050299','4401161027','5047155760','7702029405','7703534295','4025045699','7708338583','7710550185','6443021868','7801194600','7710436796','5029206035','3438008337','5402046082','5402046082','7714541576','7812014560','7728845983','5445024710','5245015772','7804391999','6658439479','7714955136','7705017253','7704208760','5020030475','7714932918','6143049372','7714117938','6672212600','6672212600','7728429849','2634081081','7740000076','5028021634','5056000107','7714822810','7710016640','7712038455','7716670545','7731659962','7816689765','7709731275','7706433175','7740000076','0276118419','6828005778','2322028036','3528171360','0725000921','7751515221','7802319940','5029127753','7723614125','7726545230','7715255320','7709229629','2124025080','5032221805','4218100297','2315088972','5406260827','7017016869','7801176986','6316048881','3446001409','7810481802','5044072266','7710728559','6027012974','7810204213','5032242756','9909125356','5032289560','7704426260','5504122776','7735143350','0400008188','5048034110','4501084048','0105052856','2465234238','2466220319','5614073056','7715765138','7707715503','4706021088','5042067447','7804164876','6617013890','5003076310','2320105623','7826027383','5024073102','7825467769','4705018660','0603009927','6670019135','7709342342','5022045100','5029145978','5050020139','2540096163','6916009860','7719738150','5037043183','5005061454','5003053909','7735574734','6027058672','7107089389','6665002866','5040073205','7816055208','9715248863','7729670341','3015062598','2461042849','6316136295','6316136295','4253022764','7720238313','5010041894','7702172300','6452052044','5027120738','7725545445','7729342140','2308267138','7116006212','7717127211','7722698789','7707049388','7707049388','5055002574','1831159930','7714933598','7604248952','7701101088','7716219981','1106022398','3818018300','7722624201','5036116657','7728623099','3442056982','1001054385','5010035805','6952319842','3123312502','7704197236','4401088176','7801651230','7816181675','7811404769','3257009280','5047187138','7801413676','7719408546','6725012156','7810392542','2609019259','2635100562','3527013850','7842393933','5050109690','5404227535','2456009733','7709362765','3127005630','4633021693','2443019893','6831017477','0263012969','7714389762','1001137458','1001137458','5045031713','5045031713','7704152556','7731604593','2308190284','1658063121','7724768576','7816223580','7840464498','7325096266','5042010200','7825365252','5504084256','2466249438','6730042163','7715517791','7717284782','3321026408','7726535270','5018206241','5528009730','6231004437','5053050445','7810730664','7722820767','2315127639','7736656394','6678061918','6125032030','7743895280','7805693488','6102025598','773388384496','1644056131','1681000024','7703059410','6324060836','7706538467','4715018236','5010026423','6319225514','7728715529','7710383375','7327049769','7710635216','5920029970','5006008140','7202128430','7204087429','5034020942','5075024417','5047002154','2463240412','6211000057','7705348791','5252019915','8602146876','5013053231','7107052212','3525150820','5010050793','6027083245','1839003879','7808007715','2636033069','7727395481','7811396885','7811152127','7733275344','9717010270','7715316326','4003016140','5004016441','1841063770','9718148433','7719403594','6901027249','5043041459','5603042137','3301013961','5904242027','5013032111','2320225984','5003077931','7709562556','9704119665','5032225937','7708738912','6606022606','7117501097','5030053930','3253000575','7706019535','7725153180','7814534043','1103042163','7726525466','1655034059','5052013497','7838492138','5023000616','2306003330','2227022549','5031018470','5024055463','5024020887','7733661269','7702387055','7710146208','4703041618','7722678655','5037042937','6164126853','6161046649','3664134279','7451195115','2128031599','7704848336','7710456087','7743085617','7715354219','7806379884','7802184161','5260343182','5902202276','4702010350','2310194536','0816001584','5043020667','9724039640','5003063054','7722747524','7722269116','7722553712','6168021153','7735504575','7604178825','7604091130'];


        for ($a = 0, $len = sizeof($etalonInn); $a < $len; $a++) {
            $inn = $etalonInn[$a];

            if (!$this->db->query(
                '
                SELECT *
                FROM pm.counteragent_requisite
                WHERE requisite_inn = :inn
            ', ['inn' => $inn]
            )->fetch()) {
                echo $inn.'<br>';
            }
        }


        exit;
    }
}